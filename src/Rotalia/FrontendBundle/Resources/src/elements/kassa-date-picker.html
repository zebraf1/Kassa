<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-date-picker/paper-date-picker.html">

<dom-module id="kassa-date-picker">
    <template>
        <style>
            .date-button {
                color: #000;
                background-color: #FFF;
                border: 1px solid #aaaaaa;
            }

        </style>

        <paper-button class="date-button" on-tap="_showStartDate">[[format(selectedStartDate, 'DD-MM-YYYY')]]</paper-button>
        <span>-</span>
        <paper-button class="date-button" on-tap="_showEndDate">[[format(selectedEndDate, 'DD-MM-YYYY')]]</paper-button>

        <paper-dialog id="dialog" class="paper-date-picker-dialog" modal on-iron-overlay-closed="_dismissDialog">
            <paper-date-picker id="picker" date="{{date}}" min-date="[[minDate]]" max-date="[[maxDate]]"></paper-date-picker>
            <div class="buttons">
                <paper-button dialog-dismiss>Cancel</paper-button>
                <paper-button dialog-confirm>OK</paper-button>
            </div>
        </paper-dialog>

    </template>
    <script>
        Polymer({
            //['Jaanuar', 'Veebruar', 'MÃ¤rts', 'Aprill', 'Mai', 'Juuni','Juuli', 'August', 'September', 'Oktoober', 'November', 'Detsember'];
            is: "kassa-date-picker",
            properties: {
                //Min and max value of datepicker
                startDate: {
                    type: Object,
                    observer: '_onStartDateChange',
                    value: function () {
                        return {year: 1913, month: 10, day:10}
                    }
                },
                endDate: {
                    type: Object,
                    observer: '_onEndDateChange',
                    value: function () {
                        return {year: new Date().getFullYear(), month: new Date().getMonth(), day: new Date().getDate()}
                    }
                },
                minDate: {
                    type: Date,
                    computed: '_computeMinDate(startDate, selectedStartDate, settingStart)'
                },
                maxDate: {
                    type: Date,
                    computed: '_computeMaxDate(endDate, selectedEndDate, settingStart)'
                },
                //Is start date being currently set?
                settingStart: {
                    type: Boolean,
                    value: true,
                    readOnly: true
                },
                //Start and end of selected range
                selectedStartDate: {
                    type: Object,
                    readOnly: true,
                    notify: true
                },
                selectedEndDate: {
                    type: Object,
                    readOnly: true,
                    notify: true
                },
                //date in datepicker object
                date: Date
            },
            format: function (date, format) {
                return moment(date).format(format)
            },
            _dismissDialog: function (e) {
                if (e.detail.confirmed) {
                    if (this.settingStart) {
                        this._setSelectedStartDate({year: this.date.getFullYear(), month: this.date.getMonth(), day: this.date.getDate()});
                    } else {
                        this._setSelectedEndDate({year: this.date.getFullYear(), month: this.date.getMonth(), day: this.date.getDate()});
                    }
                }
            },
            _showStartDate: function (e) {
                this._setSettingStart(true);
                this.set('date', moment(this.selectedStartDate).toDate());
                this.$.dialog.toggle();
            },
            _showEndDate: function (e) {
                this._setSettingStart(false);
                this.set('date', moment(this.selectedEndDate).toDate());
                this.$.dialog.toggle();
            },
            _computeMinDate: function (startDate, selectedStartDate, settingStart) {
                var date = startDate;
                if (!settingStart) {
                    date = selectedStartDate;
                }
                return new Date(date.year, date.month, date.day)
            },
            _computeMaxDate: function (endDate, selectedEndDate, settingStart) {
                var date = endDate;
                if (settingStart) {
                    date = selectedEndDate;
                }
                return new Date(date.year, date.month, date.day)
            },
            _onStartDateChange: function (newValue, oldValue) {
                this._setSelectedStartDate(newValue);
            },
            _onEndDateChange: function (newValue, oldValue) {
                this._setSelectedEndDate(newValue);
            }
        })
    </script>
</dom-module>
