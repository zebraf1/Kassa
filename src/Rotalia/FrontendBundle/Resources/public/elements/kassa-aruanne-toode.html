<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link ref="import" href="../bower_components/paper-button/paper-button.html">
<link ref="import" href="../bower_components/paper-input/paper-input.html">
<link ref="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="kassa-icons.html">
<link rel="import" href="kassa-behavior.html">

<dom-module id="kassa-aruanne-toode">
    <template>
        <style>
            :host {
                flex: 1 1 21em;
                margin: 0.2em
            }

            paper-material {
                padding: 1em;
            }

            #top {
                display: flex;
                flex-flow: row wrap;
                justify-content: space-between;
            }

            #left {
                display: flex;
                flex-flow: column nowrap;
                flex: 1 0 auto;
                padding-bottom: 2em;
            }

            #left span:first-child {
                font-size: 1.5em;
            }

            #left paper-icon-button {
                --paper-icon-button: {
                    color: #aaaaaa;
                }
            }

            #right {
                display: flex;
                flex-flow: column nowrap;
                flex: 0 0 7em;
                margin-left: auto;

            }

            #right div {
                display: flex;
                flex-flow: row nowrap;
                justify-content: space-between;
                padding: 0.1em;
            }

            #right div span {
                display: block;
                flex: 0 0 2.5em;
                text-align: right;
            }

            #right div span:first-child {
                flex: 1 0 auto;
                text-align: left;
            }

            #bottom div {
                display: flex;
                justify-content: center;
                align-items: center;
                border-top: 1px solid #aaaaaa;
                padding: 0.5em;
            }

            .borderbottom {
                border-bottom: 1px solid #000;
            }

            .striketrough {
                text-decoration: line-through;
            }

            [data-invisible] {
                visibility: hidden;
            }


        </style>

        <paper-material>
            <div id="top">
                <div id="left">
                    <span>[[toode.nimi]]</span>
                    <span>Suurus: [[toode.suurus]]</span>
                    <span>Hind: [[eur2str(toode.hind)]]</span>
                    <paper-icon-button icon="kassa:edit" hidden$="[[_computeEditIconHidden(confirmed, editing, fixed)]]" on-tap="_editKogus"></paper-icon-button>
                </div>
                <div id="right">
                    <div>
                        <span>Eelmises:</span>
                        <span>[[toode.kogusEelmises]]</span>
                    </div>
                    <div>
                        <span>Lisatud:</span>
                        <span>+[[toode.kogusLisatud]]</span>
                    </div>
                    <div class="borderbottom">
                        <span>Ostetud:</span>
                        <span>-[[toode.kogusOstetud]]</span>
                    </div>
                     <div class$="[[_computeKapisClass(toode.kogusArvutatud, toode.kogusTegelik)]]">
                        <span>Kapis:</span>
                        <span>[[toode.kogusArvutatud]]</span>
                    </div>
                    <div data-invisible$="[[_computeTegelikHidden(toode.kogusArvutatud, toode.kogusTegelik)]]">
                        <span>Tegelikult:</span>
                        <span>[[toode.kogusTegelik]]</span>
                    </div>
                </div>
            </div>
            <div id="bottom" hidden$="[[fixed]]">
                <div hidden$="[[confirmed]]">
                    <paper-button on-tap="_editKogus">Kogus Vale</paper-button>
                    <paper-button on-tap="_confirmKogus">Kogus Ã•ige</paper-button>
                </div>
                <div hidden$="[[!editing]]">
                    <paper-input label="Tegelik kogus" type="number" min="0" step="1"
                                 value="{{toode.kogusTegelik}}" id="kogusTegelik" on-focusin="_onFocusinSelect"></paper-input>
                    <paper-button on-tap="_confirmKogus">Edasi</paper-button>
                </div>
            </div>
        </paper-material>

    </template>
    <script>
        Polymer({
            is: "kassa-aruanne-toode",
            properties: {
                toode: {
                    type: Object,
                    value: {},
                    notify: true
                },
                confirmed: {
                    type: Boolean,
                    value: false,
                    readOnly: true
                },
                editing: {
                    type: Boolean,
                    value: false,
                    readOnly: true
                },
                fixed: {
                    type: Boolean,
                    value: false
                }
            },
            behaviors: [KassaBehavior],
            _computeEditIconHidden: function(confirmed, editing, fixed){
                return !confirmed || editing || fixed;
            },
            _computeTegelikHidden: function(kogusArvutatud, kogusTegelik){
                return kogusArvutatud == kogusTegelik
            },
            _computeKapisClass: function(kogusArvutatud, kogusTegelik){
                if (kogusArvutatud != kogusTegelik) {
                    return 'striketrough'
                }
                return ''
            },
            _confirmKogus: function(e){
                this._setConfirmed(true);
                this._setEditing(false);
                this.fire('kogus-confirmed');
            },
            _editKogus: function(e) {
                this._setConfirmed(true);
                this._setEditing(true);
                this.$.kogusTegelik.focus();
            },
            _onFocusinSelect: function (e) {
                var target = e.target || e.srcElement;
                target.select()
            }
        })
    </script>
</dom-module>