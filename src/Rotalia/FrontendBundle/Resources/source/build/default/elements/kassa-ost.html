<html><head></head><body><div hidden="" by-polymer-bundler=""><script>Polymer({is:'iron-a11y-keys',behaviors:[Polymer.IronA11yKeysBehavior],properties:{target:{type:Object,observer:'_targetChanged'},keys:{type:String,reflectToAttribute:!0,observer:'_keysChanged'}},attached:function(){this.target||(this.target=this.parentNode)},_targetChanged:function(b){this.keyEventTarget=b},_keysChanged:function(){this.removeOwnKeyBindings(),this.addOwnKeyBinding(this.keys,'_fireKeysPressed')},_fireKeysPressed:function(b){this.fire('keys-pressed',b.detail,{})}});</script><dom-module id="kassa-ost-toode"><template><style>paper-material{display:flex;flex-flow:row wrap;justify-content:space-between;cursor:pointer;padding:1em;}span{display:block;text-align:right;flex:0 0 auto;margin-left:auto;padding-left:0.8em;}span:first-child{flex:1 1 auto;text-align:left;padding:0;}</style><paper-material elevation="1"><span>[[product.name]]</span> <span>[[formatAmount(product.amount, product.amountType)]]</span> <span>[[eur2str(product.price)]]</span></paper-material></template><script>Polymer({is:"kassa-ost-toode",properties:{product:{type:Object}},behaviors:[KassaBehavior]});</script></dom-module><script>EqualColumnsBehavior={ready:function(){window.addEventListener('resize',this.setColumnWidths.bind(this))},setColumnWidths:function(){this.async(function(){var c=this.$.items.querySelectorAll('[kassa-columns-item]');if(0<c.length)for(var d=c[0].parentElement,e=getComputedStyle(d),f=getComputedStyle(c[0]),g=parseFloat(e.width),h=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight),j=parseFloat(f.flexBasis),k=parseFloat(f.marginLeft)+parseFloat(f.marginRight),l=Math.floor((g-h)/(j+k)),n=0;n<c.length;n++)c[n].style.maxWidth=(g-h)/l-k+'px'})}};</script><dom-module id="kassa-ost-tootegrupp"><template><style>h3{margin-left:1em;}div{display:flex;flex-flow:row wrap;}kassa-ost-toode{flex:1 0 16.8em;margin:0.2em;}</style><h3 hidden$="[[!productsCount]]"><content></content></h3><div id="items"><template is="dom-repeat" items="[[products]]" as="product" filter="[[_filter(filterVal)]]" rendered-item-count="{{productsCount}}" on-dom-change="setColumnWidths"><kassa-ost-toode product="[[product]]" on-tap="_selectProduct" kassa-columns-item=""></kassa-ost-toode></template></div></template><script>Polymer({is:'kassa-ost-tootegrupp',properties:{products:{type:Array},filterVal:{type:String,value:''}},behaviors:[EqualColumnsBehavior,KassaBehavior],selectFirst:function(){var b=this.$.items.querySelector('kassa-ost-toode');return!!this.isTrue(b)&&(this._selectProduct({model:{product:b.product}}),!0)},_filter:function(b){return function(c){return!b||!!c&&c.name&&~c.name.toLowerCase().indexOf(b.toLowerCase())}},_selectProduct:function(b){this.fire('kassa-select-product',b.model.product)}});</script></dom-module><dom-module id="kassa-ost-valitud-toode"><template><style>paper-material{display:flex;flex-flow:row wrap;justify-content:flex-start;align-items:center;padding:1em;}span{display:block;flex:0 0 auto;text-align:right;padding-left:0.8em;margin-left:auto;}span.name{flex:1 1 auto;text-align:left;padding:0;}div{display:flex;flex:0 0 auto;margin-left:auto;}paper-icon-button{flex:0 0 3em;}[data-invisible]{visibility:hidden;}</style><paper-material elevation="1"><paper-icon-button icon="kassa:clear" data-invisible$="[[fixed]]"></paper-icon-button><span class="name">[[product.name]]</span><div><span>[[product.count]] × [[product.amount]]</span> <span>[[eur2str(product.price)]]</span></div></paper-material></template><script>Polymer({is:"kassa-ost-valitud-toode",properties:{product:{type:Object},fixed:{type:Boolean,value:!1}},behaviors:[KassaBehavior]});</script></dom-module></div><dom-module id="kassa-ost"><template><style>main{display:flex;flex-flow:column nowrap;padding-bottom:300px;}.split-h{display:flex;flex-flow:row wrap;justify-content:space-between;align-items:center;padding:1em;}.split-h span, kassa-confirm-button{margin-left:auto;}</style><iron-a11y-keys target="[[_tasujaComboBox]]" keys="enter" on-keys-pressed="_selectFilterInput"></iron-a11y-keys><iron-a11y-keys target="[[_filterInput]]" keys="enter" on-keys-pressed="_selectToode"></iron-a11y-keys><iron-a11y-keys target="[[_productCountInput]]" keys="esc" on-keys-pressed="_dismissproductCountDialog"></iron-a11y-keys><iron-a11y-keys target="[[_productCountInput]]" keys="enter" on-keys-pressed="_confirmproductCountDialog"></iron-a11y-keys><main id="mainContent"><paper-material class="split-h"><vaadin-combo-box id="tasujaComboBox" label="Tasuja" value="[[member.id]]" disabled="[[ostFixed]]" on-focusin="_selectTasujaComboBox" on-focusout="_onFocusoutTasuja" item-label-path="name" item-value-path="id" items="[[members]]"></vaadin-combo-box><span style="font-size: 1.8em">Summa: [[_computeOstTotal(_chosenProducts.*)]]</span></paper-material><template is="dom-repeat" items="[[_chosenProducts]]" as="product"><kassa-ost-valitud-toode product="[[product]]" on-tap="_removeChosenProduct" fixed="[[ostFixed]]"></kassa-ost-valitud-toode></template><paper-material class="split-h"><paper-input id="filterInput" disabled="[[ostFixed]]" label="Otsi Toodet" value="{{filterVal}}" on-focusin="_selectFilterInput"></paper-input><kassa-confirm-button disabled$="[[!_chosenProducts.length]]" confirmed="{{ostFixed}}" double-confirm="" on-kassa-confirm="_confirmOst" on-kassa-double-confirm="_doubleConfirmOst">Osta</kassa-confirm-button></paper-material><template is="dom-repeat" items="[[_computeProductGroups(productGroups, products)]]" as="productGroup"><kassa-ost-tootegrupp products="[[productGroup.products]]" filter-val="[[filterVal]]" on-kassa-select-product="_onProductActivated">[[productGroup.name]]</kassa-ost-tootegrupp></template></main><paper-dialog id="productCountDialog" modal=""><paper-material class="split-h"><span class="expanding">[[activeProduct.name]]</span><paper-input id="productCountInput" type="number" min="1" step="1" no-label-float="" style="flex: 0 1 3em" value="{{activeProduct.count}}" autofocus=""></paper-input><span style="text-align:right">× [[formatAmount(activeProduct.amount, activeProduct.amountType)]]</span> <span style="text-align:right">[[_computePrice(activeProduct.count, activeProduct.price)]]</span></paper-material><div class="buttons"><paper-button dialog-dismiss="">Katkesta</paper-button><paper-button dialog-confirm="" on-tap="_onProductChocen">Lisa toode</paper-button></div></paper-dialog></template><script>Polymer({is:'kassa-ost',properties:{member:{type:Object},members:{type:Array},products:{type:Array},productGroups:{type:Array},_chosenProducts:{type:Array,readOnly:!0},_nextAllowedTime:{type:Number,value:0,readOnly:!0},_tasujaComboBox:{type:HTMLElement,readOnly:!0},_filterInput:{type:HTMLElement,readOnly:!0},_productCountInput:{type:HTMLElement,readOnly:!0}},behaviors:[PageBehavior,KassaBehavior],observers:['_loadProducts(pageActive, member.selectedConventId)','cleanUp(member.selectedConventId)'],ready:function(){this._set_tasujaComboBox(this.$.tasujaComboBox),this._set_filterInput(this.$.filterInput),this._set_productCountInput(this.$.productCountInput)},setUp:function(){this._set_chosenProducts([]),this.fire('kassa-backend-action',{action:'doMembersGet'})},cleanUp:function(){this.member&&(this.$.tasujaComboBox.value=this.member.id),this.set('ostFixed',!1),this._set_chosenProducts([])},_loadProducts:function(b,c){b&&(this.fire('kassa-backend-action',{action:'doProductsGetActive',conventId:c}),this.fire('kassa-backend-action',{action:'doProductGroupsGet'}))},_computeProductGroups:function(b,c){for(var g,d={},f=0;f<c.length;f++)g=c[f],d[g.productGroupId]||(d[g.productGroupId]=[]),d[g.productGroupId].push(g);for(var h=[],f=0;f<b.length;f++)h.push({name:b[f].name,products:'undefined'===typeof d[b[f].id]?[]:d[b[f].id]});return this.isTrue(d[null])&&h.push({name:'Grupeerimata',products:d[null]}),h},_selectTasujaComboBox:function(){this.$.tasujaComboBox.inputElement.select()},_onFocusoutTasuja:function(){''===this.$.tasujaComboBox.value&&(this.$.tasujaComboBox.value=this.member.id)},_selectFilterInput:function(){this.$.filterInput.inputElement.select()},_computeOstTotal:function(b){for(var c=0,d=0;d<b.base.length;d++)c+=this.eur2cent(b.base[d].price);return this.cent2str(c)},_selectToode:function(){for(var b=this.$.mainContent.querySelectorAll('kassa-ost-tootegrupp'),c=0;c<b.length;c++)if(b[c].selectFirst())return null},_onProductActivated:function(b){!this.ostFixed&&Date.now()>this._nextAllowedTime&&(this.activeProduct=b.detail,this.set('activeProduct.count','1'),this.set('filterVal',''),this.$.productCountDialog.open())},_computePrice:function(b,c){return this.eur2str(b*c)},_confirmproductCountDialog:function(){this.$.productCountDialog.close(),this._onProductChocen(),this._selectFilterInput()},_dismissproductCountDialog:function(){this.$.productCountDialog.close(),this._selectFilterInput()},_onProductChocen:function(){this._set_nextAllowedTime(Date.now()+200),this.push('_chosenProducts',{id:this.activeProduct.id,name:this.activeProduct.name,amount:this.formatAmount(this.activeProduct.amount,this.activeProduct.amountType),count:this.activeProduct.count,price:this.activeProduct.price*this.activeProduct.count}),this.async(function(){this._selectFilterInput()})},_removeChosenProduct:function(b){this.ostFixed||'icon'!=Polymer.dom(b).rootTarget.id&&'paper-icon-button'!==Polymer.dom(b).rootTarget.localName||this.splice('_chosenProducts',b.model.__data__.index,1)},_confirmOst:function(){this._onFocusoutTasuja()},_doubleConfirmOst:function(){var b=this;this.fire('kassa-backend-action',{action:'doPurchasePost',conventId:this.member.selectedConventId,memberId:this._tasujaComboBox.value,basket:this._chosenProducts.map(function(c){return b.pickProperties(c,['id','count'])}),onSuccess:function(){this.cleanUp()}.bind(this),onError:function(){this.set('ostFixed',!1)}.bind(this)})}});</script></dom-module></body></html>