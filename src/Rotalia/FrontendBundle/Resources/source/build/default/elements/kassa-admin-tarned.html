<html><head></head><body><div hidden="" by-polymer-bundler=""><dom-module id="kassa-admin-tarned-dialog"><template><style>[hidden]{display:none;}</style><main hidden$="[[!opened]]"><slot></slot></main></template><script>Polymer({is:'kassa-admin-tarned-dialog',properties:{opened:{type:Boolean,value:!1,notify:!0}},behaviors:[KassaBehavior],listeners:{tap:'_onDialogClick'},open:function(){this.set('opened',!0)},close:function(){this.set('opened',!1)},_onDialogClick:function(b){for(var f,c=Polymer.dom(b).path,d=0,e=c.indexOf(this);d<e;d++)if(f=c[d],f.hasAttribute&&(f.hasAttribute('dialog-dismiss')||f.hasAttribute('dialog-confirm'))){this.close(),b.stopPropagation();break}}});</script></dom-module><dom-module id="kassa-admin-tarned-rows"><template><style></style><kassa-material direction="vertical"><kassa-material direction="horizontal" flat="" style="align-self: stretch"><vaadin-combo-box id="input" selected-item="{{selectedItem}}" label="Toode" items="[[products]]" item-value-path="id" item-label-path="name" on-focusin="_onFocusIn" disabled="[[disabled]]"><template>[[item.name]]<br>Suurus: [[formatAmount(item.amount, item.amountType)]]</template></vaadin-combo-box><paper-button raised="" on-tap="_addProduct" class="row-break" disabled="[[disabled]]">Lisa</paper-button></kassa-material><paper-input id="productCountInput" type="number" min="1" step="1" value="{{productCount}}" label="Kogus" disabled="[[disabled]]"></paper-input><paper-input label="Tüki hind (€)" type="number" step="0.1" value="{{productPrice}}" disabled="[[disabled]]"></paper-input></kassa-material><template is="dom-repeat" items="[[chosenProducts]]" as="product"><kassa-ost-valitud-toode product="[[product]]" on-tap="_removeProduct" fixed="[[disabled]]"></kassa-ost-valitud-toode></template></template><script>Polymer({is:'kassa-admin-tarned-rows',properties:{products:{type:Array},chosenProducts:{type:Array,value:[]},value:{type:Array,value:[],computed:'_computeValue(chosenProducts.*)'},selectedItem:{type:Object,value:null},productCount:{type:Number,value:0},productPrice:{type:Number,value:0},disabled:{type:Boolean,value:!1}},behaviors:[KassaBehavior],_onFocusIn:function(){this.$.input.inputElement.select()},_addProduct:function(){null!==this.selectedItem&&(this.splice('chosenProducts',0,0,{id:this.selectedItem.id,name:this.selectedItem.name,amount:this.selectedItem.amount,amountType:this.selectedItem.amountType,count:this.productCount,price:this.productPrice}),this.set('selectedItem',null),this.set('productCount',0),this.set('productPrice',0))},_removeProduct:function(b){('icon'===Polymer.dom(b).rootTarget.id||'paper-icon-button'===Polymer.dom(b).rootTarget.localName)&&this.splice('chosenProducts',b.model.__data.index,1)},clear:function(){this.set('chosenProducts',[]),this.set('selectedItem',null),this.set('productCount',0),this.set('productPrice',0)},_computeValue:function(b){var c=this;return b.base.map(function(d){return c.pickProperties(d,['id','count','price'],['productId','count','currentPrice'])})}});</script></dom-module></div><dom-module id="kassa-admin-tarned"><template><style>kassa-material{margin-bottom:1em;}</style><div hidden$="[[dialogOpen]]"><kassa-material direction="horizontal"><kassa-date-picker on-kassa-confirm="_loadDeliveries" start-date="{{_startDate}}" end-date="{{_endDate}}"></kassa-date-picker></kassa-material><kassa-table items="[[deliveries]]" add-func="doDeliveryPost" dialog="[[dialog]]" scroll-target="[[scrollTarget]]" convent-id="[[conventId]]" row-details-name="kassa-admin-tarned"><vaadin-grid-column flex-grow="0" width="3em"><template class="header"><span style="text-align: right">Id</span></template><template><span style="text-align: right">[[item.id]]</span></template></vaadin-grid-column><vaadin-grid-column flex-grow="1"><template class="header"><vaadin-grid-filter path="member" value="[[_memberFilter]]"><paper-input label="Koostaja" value="{{_memberFilter}}" slot="filter" no-label-float=""></paper-input></vaadin-grid-filter></template><template><span>[[item.member]]</span></template></vaadin-grid-column><vaadin-grid-column><template class="header">Kust</template><template><span>[[_mapInventoryType(item.source)]]</span></template></vaadin-grid-column><vaadin-grid-column><template class="header">Kuhu</template><template><span>[[_mapInventoryType(item.target)]]</span></template></vaadin-grid-column><vaadin-grid-column flex-grow="0"><template class="header"><span style="text-align: right">Sularaha</span></template><template><span style="text-align: right">[[eur2str(item.cash)]]</span></template></vaadin-grid-column><vaadin-grid-column flex-grow="0" width="150px"><template class="header">Aeg</template><template><span>[[item.createdAt]]</span></template></vaadin-grid-column></kassa-table></div><kassa-admin-tarned-dialog id="deliveriesDialog" opened="{{dialogOpen}}"><kassa-material direction="horizontal"><paper-button dialog-dismiss="" raised="" disabled="[[_isRequestLoading]]" style="margin-left: auto">Sulge</paper-button><kassa-confirm-button style="margin-right: 16px" confirmed="{{_isRequestLoading}}">Salvesta</kassa-confirm-button></kassa-material><kassa-material direction="vertical"><div style="display: flex; flex-flow: row nowrap; align-items: flex-end"><vaadin-combo-box data-field="source" disabled="[[_isRequestLoading]]" label="Kust" item-value-path="value" item-label-path="label" items="[[locations]]" style="flex: 1 1 50%"></vaadin-combo-box><vaadin-combo-box data-field="target" disabled="[[_isRequestLoading]]" label="Kuhu" item-value-path="value" item-label-path="label" items="[[locations]]" style="flex: 1 1 50%; margin-left: 0.8em"></vaadin-combo-box></div><paper-input data-field="cash" label="Sularaha (€)" type="number" step="0.1" disabled="[[_isRequestLoading]]"></paper-input></kassa-material><kassa-admin-tarned-rows data-field="reportRows" products="[[products]]" disabled="[[_isRequestLoading]]"></kassa-admin-tarned-rows></kassa-admin-tarned-dialog></template><script>Polymer({is:'kassa-admin-tarned',properties:{conventId:{type:Number},products:{type:Array,value:[]},deliveries:{type:Array},singleDelivery:{type:Object},dialog:{type:Node},_startDate:{type:String},_endDate:{type:String},locations:{type:Array,value:function(){return[{label:'Universum',value:'__null__'},{label:'Ladu',value:'warehouse'},{label:'Kassa',value:'storage'}]}}},behaviors:[PageBehavior,KassaBehavior],observers:['_loadDeliveries(pageActive, conventId)'],ready:function(){this.set('dialog',this.$.deliveriesDialog)},setUp:function(){this.$$('kassa-date-picker').ready()},cleanUp:function(){this.set('deliveries',[])},_loadDeliveries:function(b,c){b&&c!==void 0&&(this.fire('kassa-page-loading'),this.cleanUp(),this.fire('kassa-backend-action',{action:'doProductsGetActive',conventId:c}),this.fire('kassa-backend-action',{action:'doReportsGet',conventId:this.conventId,dateFrom:this._startDate,dateUntil:this._endDate,reportType:'UPDATE',onSuccess:function(){this.fire('kassa-page-ready',{page:this})}.bind(this)}))},_mapInventoryType:function(b){return{storage:'Kassa',warehouse:'Ladu'}[b]}});</script></dom-module></body></html>