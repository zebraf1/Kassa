<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">

<link rel="import" href="kassa-icons.html">
<link rel="import" href="kassa-rotating-selector.html">
<link rel="import" href="kassa-behavior.html">

<dom-module id="kassa-left-drawer">
	<template>
		<style>
			:host {
				background-color: var(--kassa-dark-color);
				box-shadow: 4px 0 4px rgba(0, 0, 0, 0.3);
				height: 100%;
				display: flex;
				flex-flow: column nowrap;
				padding-bottom: 0.5em;
				box-sizing: border-box;
				align-items: stretch;
				text-align: left;
			}

			#leftHead {
				height: 192px;
				color: var(--kassa-primary-color);
				display: flex;
				flex-flow: column nowrap;
				justify-content: flex-end;
				padding: 0 1em;
			}

			#leftHead h2, #leftHead h3 {
				margin: 0.3em 0;
			}

			paper-listbox {
				width: 100%;
				background-color: var(--kassa-dark-color);
				padding: 0;
			}

			paper-listbox a {
				display: block;
				color: #FFF;
				box-sizing: border-box;
				padding: 0.5em 1em;
				font-size: 1.2em;
				font-weight: bold;
				font-variant: small-caps;
				text-decoration: none;
				border-top: 1px solid var(--kassa-secondary-color);
				border-bottom: 1px solid var(--kassa-secondary-color);
			}

			paper-listbox a:hover {
				background-color: #01233B;
			}

			paper-listbox a:first-child {
				border-top: 2px solid var(--kassa-secondary-color);
			}

			paper-listbox a:last-child {
				border-bottom: 2px solid var(--kassa-secondary-color);
			}

			main {
				overflow-y: auto;
				height: 100%;
				flex: 1 1 100%;
				width: 100%;
			}

			.bottom-button {
				display: block;
				box-sizing: border-box;
				padding: 0.5em 1em;
				font-size: 1.2em;
				font-weight: bold;
				width: 100%;
				height: 2.2em;
				color: var(--kassa-primary-color);
				text-decoration: none;
				cursor: pointer;
			}

			.bottom-button:hover {
				text-shadow: 0px 0px 2px var(--kassa-primary-color);
			}

			iron-icon {
				height: 1.2em;
				width: 1.2em;
				margin-bottom: 0.3em;
				margin-right: 0.4em;
			}

			[hidden] {
				display: none;
			}


		</style>
		<main hidden$="[[!isTrue(member)]]">
			<div id="leftHead">
				<h2>{{member.name}}</h2>
				<h3>Saldo: {{eur2str(member.creditBalance)}}</h3>
			</div>

			<paper-listbox selected="{{page}}" attr-for-selected="data-page">
				<template is="dom-repeat" items="[[navigation]]" as="site">
					<template is="dom-if" if="{{_hasRights(member, site.role)}}">
						<a data-page="[[site.page]]" href="#/[[site.page]]">[[site.name]]</a>
					</template>
				</template>
			</paper-listbox>
		</main>
		<kassa-rotating-selector hidden$="[[!isTrue(member)]]" class="bottom-button"
		                         convent-id="{{configuration.selectedConventId}}"
		                         active-convents="[[activeConvents]]" member="[[member]]">
			<iron-icon icon="kassa:room"></iron-icon>
		</kassa-rotating-selector>
		<a href="#/logout" hidden$="[[!isTrue(member)]]" class="bottom-button">
			<iron-icon icon="kassa:exit-to-app"></iron-icon>
			Logi v√§lja</a>
	</template>
	<script>
        Polymer({
            is: "kassa-left-drawer",
            properties: {
                member: {
                    type: Object
                },
                page: {
                    type: String
                },
                activeConvents: {
                    type: Array
                },
                navigation: {
                    type: Array
                },
	            configuration: {
                    type: Object,
		            notify: true
	            }
            },
            behaviors: [KassaBehavior],
            _hasRights: function (member, role) {
                if (this.isTrue(member)) {
                    return member.roles.indexOf(role) >= 0;
                }
                return false;
            }
        })
	</script>
</dom-module>
