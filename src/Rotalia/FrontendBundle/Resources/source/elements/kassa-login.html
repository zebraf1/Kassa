<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/iron-a11y-keys-behavior/iron-a11y-keys-behavior.html">

<link rel="import" href="kassa-behavior.html">
<link rel="import" href="kassa-page-behavior.html">
<link rel="import" href="kassa-confirm-button.html">

<dom-module id="kassa-login">
    <template>
        <style>
            main {
                display: flex;
                flex-flow: column nowrap;
                max-width: 20em;
                padding-bottom: 300px;
            }

        </style>

        <main hidden$="[[_hideForm]]">
            <form name="loginForm" id="loginForm" action="">
                <paper-input name="username" label="Kasutajanimi" type="text" disabled="[[confirmed]]" value="{{_username}}" required></paper-input>
                <paper-input name="password" label="Parool" type="password" disabled="[[confirmed]]" value="{{_password}}" required></paper-input>
                <kassa-confirm-button id="confirmButton" confirmed="{{confirmed}}" on-kassa-confirm="_doLogin">Sisene</kassa-confirm-button>            
            </form>
        </main>

    </template>
    <script>
        Polymer({
            is: "kassa-login",
            properties: {
                _username: {
                    type: String
                },
                _password: {
                    type: String
                },
                _hideForm: {
                    type: Boolean,
                    readOnly: true,
                    value: true
                }
            },
            behaviors: [Polymer.IronA11yKeysBehavior, KassaBehavior, PageBehavior],
            keyBindings: {
                'enter': '_doLogin'
            },
            setUp: function () {
                this.fire('kassa-backend-action', {action: 'doAuthenticationGet', onSuccess: function () {
                    this._set_hideForm(false);
                }.bind(this)})
            },
            cleanUp: function () {
                this.$.confirmButton.reset();
                this.set('_username', '');
                this.set('_password', '');
            },
            _doLogin: function (event) {
                // Kui vajutati eneterit, siis Ã¤ra tee midagi.
                event.preventDefault();

                if (this._hideForm) {
                    return null
                }

                this.set('confirmed', true);
                this.$.confirmButton._setLoading(true);

                this.fire('kassa-backend-action',
                    {action: 'doLogin', username: this._username, password: this._password, 
                        onError: this.cleanUp.bind(this)})
            }
        })
    </script>
</dom-module>
