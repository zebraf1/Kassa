<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/lazy-imports/lazy-imports-behavior.html">

<link rel="import" href="kassa-loading-page.html">
<link rel="import" href="kassa-behavior.html">

<dom-module id="kassa-pages">
	<link rel="lazy-import" group="login" href="kassa-login.html">
	<link rel="lazy-import" group="logout" href="kassa-logout.html">
	<link rel="lazy-import" group="ost" href="kassa-ost.html">
	<link rel="lazy-import" group="admin-tooted" href="kassa-admin-tooted.html">
	<link rel="lazy-import" group="admin-tootegrupid" href="kassa-admin-tootegrupid.html">
	<link rel="lazy-import" group="admin-kassad" href="kassa-admin-kassad.html">
	<template>
		<style>
			main {
				height: 100%;
				width: 100%;
				display: block;
				padding: 1em;
				overflow: auto;
				box-sizing: border-box;
				-webkit-box-sizing: border-box;
				-moz-box-sizing: border-box;
				-ms-box-sizing: border-box;
				-o-box-sizing: border-box;
			}

		</style>

		<main>
			<iron-pages selected="[[shown]]" attr-for-selected="data-page" selected-item="{{selectedItem}}">
				<kassa-loading-page data-page="loading"></kassa-loading-page>
				<slot></slot>
			</iron-pages>
		</main>

	</template>
	<script>
        Polymer({
            is: "kassa-pages",

            properties: {
                selected: {
                    type: String,
                    observer: '_onSelectedChange'
                },
                shown: {
                    type: String,
                    value: 'loading',
                    readOnly: true
                },
                selectedItem: {
                    type: HTMLElement,
                    observer: '_onPageChange'
                },
                scrollTarget: {
                    type: HTMLElement,
                    notify: true,
                    readOnly: true
                }
            },
            behaviors: [KassaBehavior, Polymer.LazyImportsBehavior],
            ready: function () {
                this._setScrollTarget(this.$$('main'));
            },
            _onSelectedChange: function (newPage, oldPage) {
                this._setShown('loading');
                this.$$('main').scrollTop = 0;
                this.importLazyGroup(newPage).then(function () {
                    this._setShown(newPage);
                }.bind(this));
            },
            _onPageChange: function (newPage, oldPage) {
                //kassa-page-behavior
                if (newPage && newPage.sharedSetUp) {
                    newPage.sharedSetUp();
                    newPage.setScrollTarget(this.scrollTarget);
                }

                if (oldPage && oldPage.sharedCleanUp) {
                    oldPage.sharedCleanUp();
                }
            }
        })
	</script>
</dom-module>
