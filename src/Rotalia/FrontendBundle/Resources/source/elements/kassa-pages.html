<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/lazy-imports/lazy-imports-behavior.html">

<link rel="import" href="kassa-loading-page.html">
<link rel="import" href="kassa-behavior.html">

<dom-module id="kassa-pages">
	<link rel="lazy-import" group="login" href="kassa-login.html">
	<link rel="lazy-import" group="logout" href="kassa-logout.html">
	<link rel="lazy-import" group="ost" href="kassa-ost.html">
	<link rel="lazy-import" group="admin-tooted" href="kassa-admin-tooted.html">
	<link rel="lazy-import" group="admin-tootegrupid" href="kassa-admin-tootegrupid.html">
	<link rel="lazy-import" group="admin-kassad" href="kassa-admin-kassad.html">
	<link rel="lazy-import" group="admin-ylekanded" href="kassa-admin-ylekanded.html">
	<template>
		<style>
			main {
				height: 100%;
				width: 100%;
				display: block;
				padding: 1em;
				overflow: auto;
				box-sizing: border-box;
				-webkit-box-sizing: border-box;
				-moz-box-sizing: border-box;
				-ms-box-sizing: border-box;
				-o-box-sizing: border-box;
			}

		</style>

		<main>
			<iron-pages selected="[[shown]]" attr-for-selected="data-page">
				<kassa-loading-page data-page="loading"></kassa-loading-page>
				<slot></slot>
			</iron-pages>
		</main>

	</template>
	<script>
        Polymer({
            is: "kassa-pages",

            properties: {
                selected: {
                    type: String,
                    observer: '_onSelectedChange'
                },
                shown: {
                    type: String,
                    value: 'loading',
                    readOnly: true
                },
                selectedPage: {
                    type: HTMLElement,
	                readOnly: true
                },
                scrollTarget: {
                    type: HTMLElement,
                    notify: true,
                    readOnly: true
                }
            },
            behaviors: [KassaBehavior, Polymer.LazyImportsBehavior],
            listeners: {
                'kassa-page-loading': '_onPageLoading',
	            'kassa-page-ready': '_onPageReady'
            },
            ready: function () {
                this._setScrollTarget(this.$$('main'));
            },
            _onSelectedChange: function (newPage) {
                this._setShown('loading');
                this.$$('main').scrollTop = 0;

                if (this.selectedPage) {
                    this.selectedPage.sharedCleanUp();
                }

                this.importLazyGroup(newPage).then(function () {
                    //Tells the new page to do its setup.
                    var newPageItem = this.$$('iron-pages')._valueToItem(newPage);
	                newPageItem.sharedSetUp();
                    newPageItem.setScrollTarget(this.scrollTarget);
                }.bind(this));
            },
            _onPageLoading: function () {
                this._setShown('loading');
            },
	        _onPageReady: function (event) {
                if (this.selected === event.detail.page.getAttribute('data-page')) {
                    this._setSelectedPage(event.detail.page);
                    this._setShown(this.selected);
                }
            }
        })
	</script>
</dom-module>
