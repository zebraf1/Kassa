<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="kassa-page-behavior.html">
<link rel="import" href="kassa-behavior.html">
<link rel="import" href="kassa-confirm-button.html">
<link rel="import" href="kassa-table.html">
<link rel="import" href="kassa-material.html">
<link rel="import" href="kassa-date-picker.html">


<dom-module id="kassa-ylevaade-ylekanded">
	<template>
		<style>
			kassa-material {
				margin-bottom: 1em;
			}
		</style>

		<kassa-material direction="horizontal">
			<kassa-date-picker on-kassa-confirm="_loadTransfers" start-date="{{_startDate}}" end-date="{{_endDate}}"></kassa-date-picker>
		</kassa-material>

		<kassa-table items="[[_mapIdsToValues(transfers.*, members)]]" scroll-target="[[scrollTarget]]"
		             convent-id="[[conventId]]" row-details-info="[[rowDetailsInfo]]">
			<vaadin-grid-column flex-grow="0" width="3em">
				<template class="header"><span style="text-align: right;">Id</span></template>
				<template>
					<span style="text-align: right;">[[item.id]]</span>
				</template>1
			</vaadin-grid-column>
			<vaadin-grid-column flex-grow="1">
				<template class="header">Nimi</template>
				<template>
					<span>[[item.member]]</span>
				</template>
			</vaadin-grid-column>
			<vaadin-grid-column flex-grow="0">
				<template class="header">Konvent</template>
				<template>
					<span>[[item.convent]]</span>
				</template>
			</vaadin-grid-column>
			<vaadin-grid-column flex-grow="0">
				<template class="header"><span style="text-align: right;">Summa</span></template>
				<template>
					<span style="text-align: right;">[[eur2str(item.sum)]]</span>
				</template>
			</vaadin-grid-column>
			<vaadin-grid-column flex-grow="0">
				<template class="header">Lisaja</template>
				<template>
					<span>[[item.createdBy]]</span>
				</template>
			</vaadin-grid-column>
			<vaadin-grid-column  flex-grow="0" width="150px">
				<template class="header">Aeg</template>
				<template>
					<span>[[item.createdAt]]</span>
				</template>
			</vaadin-grid-column>
		</kassa-table>

	</template>
	<script>
        Polymer({
            is: "kassa-ylevaade-ylekanded",
            properties: {
                memberId: {
                    type: Number
                },
                transfers: {
                    type: Array
                },
                members: {
                    type: Array
                },
                dialog: {
                    type: Node
                },
                rowDetailsInfo: {
                    type: Object
                },
                _startDate: {
                    type: String
                },
                _endDate: {
                    type: String
                }
            },
            behaviors: [PageBehavior, KassaBehavior],
	        ready: function () {
                this.set('rowDetailsInfo', {name: 'kassa-ylekanded'})
            },
            setUp: function () {
                this.fire('kassa-backend-action', {action: 'doMembersGet'});
                this._loadTransfers();
            },
            cleanUp: function() {
                this.set('transfers', []);
            },
            _loadTransfers: function () {
                if (this.pageActive) {
                    this.fire('kassa-page-loading');
                    this.cleanUp();
                    this.fire('kassa-backend-action', {
                        action: 'doTransfersGet',
	                    memberId: this.memberId,
                        dateFrom: this._startDate, dateUntil: this._endDate,
                        onSuccess: function () {
                            this.fire('kassa-page-ready', {page: this})
                        }.bind(this)
                    });
                }
            },
            _mapIdsToValues: function(transfers, members) {
                transfers = transfers.base;
                if ((transfers !== undefined) && (members !== undefined)) {
                    return this.mapIdsToValues(transfers, {
                        'memberId': [members, 'name']
                    })
                }

                return [];
            }
        })
	</script>
</dom-module>



